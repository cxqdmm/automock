(function(){var t={7249:function(t,e,a){"use strict";var n=a(9014),i=a.n(n),s=a(736),o=a.n(s),l=a(3329),r=a.n(l),c=a(3280),d=a.n(c),u=a(2331),h=a.n(u),p=a(2319),m=a.n(p),f=a(2245),v=a.n(f),b=a(6668),y=a.n(b),g=a(4412),w=a.n(g),C=a(7349),_=a.n(C),k=a(4863),j=a.n(k),D=a(8782),x=a.n(D),S=a(1192),R=a.n(S),O=a(4400),A=a.n(O),E=a(8807),T=a.n(E),V=a(2711),$=a.n(V),N=a(8935),M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("List")],1)},Y=[],z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list"},[a("div",{staticClass:"list-head"},[a("div",{staticClass:"list-head-search"},[a("div",{staticClass:"list-head-item"},[a("span",{staticClass:"list-head-item-label"},[t._v("规则")]),a("el-select",{staticClass:"list-head-item",attrs:{placeholder:"请选择关联的pattern"},on:{change:t.searchApi},model:{value:t.search.rule,callback:function(e){t.$set(t.search,"rule",e)},expression:"search.rule"}},t._l(t.activeRules,(function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.value}})})),1)],1),a("el-input",{staticClass:"list-head-item list-head-name",attrs:{clearable:"",placeholder:"接口名模糊匹配"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchApi.apply(null,arguments)}},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchApi},slot:"append"})],1)],1),a("div",{staticClass:"list-head-action"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handleCreate}},[t._v("新建")]),a("el-divider",{attrs:{direction:"vertical"}}),t.search.onlymock?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.batchDelete}},[t._v("清空mock")]):a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.batchDelete}},[t._v("清空非mock项")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-switch",{attrs:{"active-text":"显示mock","inactive-text":"","active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.searchApi},model:{value:t.search.onlymock,callback:function(e){t.$set(t.search,"onlymock",e)},expression:"search.onlymock"}})],1)]),a("div",{staticClass:"container"},[a("div",{staticClass:"list-body",class:{"show-detail":!!t.currentRow}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,"highlight-current-row":"",height:"800",border:"",size:"mini","row-key":"name"},on:{"current-change":t.handleSelectRow}},[a("el-table-column",{attrs:{prop:"name",label:"文件名","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name"},[a("div",{staticClass:"name-value font-bold",class:{blue:e.row.mock}},[t._v(" "+t._s(e.row.name)+" ")])])]}}])}),a("el-table-column",{attrs:{width:"100",label:"mock模式"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{staticClass:"name-tag font-bold",attrs:{effect:"dark",size:"mini",type:"success"}},[t._v(t._s(e.row.ruleValue))])]}}])}),a("el-table-column",{attrs:{prop:"rule","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.rule?a("div",{staticClass:"no-wrap line-height-1 blue font-bold flex align-center"},[a("span",{staticClass:"table-label"},[t._v("rule：")]),a("div",{staticClass:"flex-1"},[t._v(t._s(e.row.rule))])]):t._e(),e.row.url?a("div",{staticClass:"no-wrap line-height-1 font-bold flex align-baseline"},[a("span",{staticClass:"table-label"},[t._v("url：")]),a("span",{staticClass:"flex-1"},[t._v(t._s(e.row.url))])]):t._e()]}}])},[a("template",{slot:"header"},[t._v(" 接口信息 "),a("el-tooltip",{attrs:{effect:"light",content:"最近一次匹配的接口信息",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)],2),a("el-table-column",{attrs:{prop:"mockTime",width:"140"}},[a("template",{slot:"header"},[t._v(" mock时间 "),a("el-tooltip",{attrs:{effect:"light",content:"最近一次mock接口的时间",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)],2),a("el-table-column",{attrs:{prop:"updateTime",width:"140"}},[a("template",{slot:"header"},[t._v(" 更新时间 "),a("el-tooltip",{attrs:{effect:"light",content:"文件最近一次更新的时间",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)],2),a("el-table-column",{attrs:{width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{input:function(a){return t.updateMock(a,e.row)}},model:{value:e.row.mock,callback:function(a){t.$set(e.row,"mock",a)},expression:"scope.row.mock"}})]}}])},[a("template",{slot:"header"},[t._v(" mock "),a("el-tooltip",{attrs:{effect:"light",content:"开启mock后，文件内容只能通过手动编辑修改",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)],2),a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return a.stopPropagation(),t.handleEdit(e.row)}}},[t._v(" 编辑 ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.deleteApi(e.row,e.$index)}}},[t._v(" 删除 ")])]}}])})],1)],1),t.currentRow?a("div",{staticClass:"detail"},[a("i",{staticClass:"el-icon-close",on:{click:t.closeDetail}}),a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"详细信息"}},[a("div",{staticClass:"detail-item"},[a("div",{staticClass:"label"},[t._v("文件名")]),a("div",{staticClass:"value"},[t._v(t._s(t.currentRow.name))])]),a("div",{staticClass:"detail-item"},[a("div",{staticClass:"label"},[t._v("url")]),a("div",{staticClass:"value"},[t._v(t._s(t.currentRow.url))])]),a("div",{staticClass:"detail-item"},[a("div",{staticClass:"label"},[t._v("rule")]),a("div",{staticClass:"value"},[t._v(t._s(t.currentRow.rule))])]),a("div",{staticClass:"detail-item"},[a("div",{staticClass:"label"},[t._v("updateTime")]),a("div",{staticClass:"value"},[t._v(t._s(t.currentRow.updateTime))])])]),a("el-tab-pane",{attrs:{label:"query"}},t._l(Object.keys(t.currentRow.query||{}),(function(e){return a("div",{key:e,staticClass:"detail-item"},[a("div",{staticClass:"label"},[t._v(t._s(e))]),a("div",{staticClass:"value"},[t._v(t._s(t.currentRow.query[e]))])])})),0),a("el-tab-pane",{attrs:{label:"payload"}},[a("code-editor",{ref:"edit",attrs:{"show-btns":!1,"expanded-on-start":!0,mode:"code",lang:"zh"},model:{value:t.currentRow.payload,callback:function(e){t.$set(t.currentRow,"payload",e)},expression:"currentRow.payload"}})],1)],1)],1):t._e()]),a("div",{staticClass:"list-footer"}),a("api-window",{attrs:{"is-edit":t.editData.isEdit,visible:t.editData.visible,data:t.editData},on:{close:t.hideApiWindow,confirm:t.handleConfirm}})],1)},L=[];function J(t){return fetch("/cgi-bin/api-list",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function U(){return fetch("/cgi-bin/check-api-list").then((t=>t.json()))}function B(){return fetch("/cgi-bin/init?_="+Date.now(),{method:"get",referrer:location.origin}).then((t=>t.json()))}function H(t,e){return fetch("/cgi-bin/update-api-data",{method:"post",body:JSON.stringify({name:t,data:e}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function P(t){return fetch("/cgi-bin/create-api-data",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function I(t,e){return fetch("/cgi-bin/update-api-mock",{method:"post",body:JSON.stringify({name:t,mock:e}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function q(t){return fetch("/cgi-bin/delete-api",{method:"post",body:JSON.stringify({name:t}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function W(t){return fetch("/cgi-bin/batch-delete-api",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}var Z=a(3189),F=a.n(Z),G=a(2371),K=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog",attrs:{title:t.isEdit?"编辑":"新建",fullscreen:"",visible:t.visible,width:"1000px","before-close":t.close}},[a("div",{staticClass:"item"},[a("span",{staticClass:"item-label"},[t._v(" 模式: ")]),a("el-radio-group",{attrs:{disabled:t.isEdit},model:{value:t.ruleValue,callback:function(e){t.ruleValue=e},expression:"ruleValue"}},[a("el-radio",{attrs:{label:"pathname"}},[t._v("pathname")]),a("el-radio",{attrs:{label:"href"}},[t._v("href")])],1)],1),t.isEdit?a("div",{staticClass:"item"},[a("span",{staticClass:"item-label"},[t._v(" 名称: ")]),a("div",{staticClass:"item-value"},[t._v(t._s(t.name))])]):a("div",{staticClass:"item"},[a("span",{staticClass:"item-label"},[t._v(" 名称: ")]),a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入url",disabled:t.isEdit},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),a("div",{staticClass:"editor"},[a("span",{staticClass:"item-label"},[t._v(" 内容: ")]),a("code-editor",{ref:"edit",attrs:{"show-btns":!1,"expanded-on-start":!0,mode:"code",lang:"zh"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.close}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)])},Q=[],X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"json-editor"},[a("div",{staticClass:"jsoneditor-vue"}),!1!==t.showBtns?a("div",{staticClass:"jsoneditor-btns"},[a("button",{staticClass:"json-save-btn",attrs:{type:"button",disabled:t.error},on:{click:function(e){return t.onSave()}}},[t._v(" "+t._s(t.locale[t.lang].save)+" ")])]):t._e()])},tt=[],et=a(5056),at=a.n(et),nt={props:{value:[String,Number,Object,Array],showBtns:[Boolean],expandedOnStart:{type:Boolean,default:!1},mode:{type:String,default:"tree"},modes:{type:Array,default:function(){return["tree","code","text","view"]}},lang:{type:String,default:"en"}},data(){return{editor:null,error:!1,json:this.value,internalChange:!1,locale:{it:{save:"SALVA"},en:{save:"SAVE"},zh:{save:"保存"}}}},watch:{value:{immediate:!0,async handler(t){this.internalChange||(await this.setEditor(t),this.error=!1)},deep:!0}},mounted(){let t=this,e={mode:this.mode,modes:this.modes,onChange(){try{let e=t.editor.get();t.json=e,t.error=!1,t.$emit("json-change",e),t.internalChange=!0,t.$emit("input",e),t.$nextTick((function(){t.internalChange=!1}))}catch(e){t.error=!0,t.$emit("has-error",e)}},onModeChange(){}};this.editor=new(at())(this.$el.querySelector(".jsoneditor-vue"),e,this.json)},methods:{onSave(){this.$emit("json-save",this.json)},async setEditor(t){this.editor&&this.editor.set(t)}}},it=nt,st=a(1001),ot=(0,st.Z)(it,X,tt,!1,null,"2d467e86",null),lt=ot.exports,rt={props:{isEdit:{type:Boolean,default:!1},data:{type:Object,deafult:{}},visible:{type:Boolean,default:!1}},components:{"code-editor":lt},data(){return{content:{},name:"",ruleValue:"pathname"}},watch:{visible(t){t&&(this.content=this.data.content,this.ruleValue=this.data.ruleValue||"pathname",this.name=this.data.name)}},methods:{close(){this.$emit("close")},validate(){try{const t=new URL(this.name);return t.protocol?t.host?t.pathname?[!0]:[!1,"pathname不能为空"]:[!1,"host不能为空"]:[!1,"协议不能为空"]}catch(t){return[!1,"new URL() 无法解析出名称，请检查"]}},getName(){const t=new URL(this.name);return"pathname"===this.ruleValue?t.origin+t.pathname:"href"===this.ruleValue?t.href:void 0},confirm(){const[t,e]=this.validate();if(!t)return _().error(e);this.$emit("confirm",{content:this.content,name:this.getName(),ruleValue:this.ruleValue})}}},ct=rt,dt=(0,st.Z)(ct,K,Q,!1,null,"53726c16",null),ut=dt.exports,ht={name:"api-list",components:{"api-window":ut,"code-editor":lt},mounted(){this.searchApi(),this.autoUpdateList(),this.getInit(),document.addEventListener("visibilitychange",this.visibleChange)},data(){return{search:{name:"",rule:"",onlymock:!1},list:[],activeRules:[{name:"全部",value:""}],view:{},editRow:null,editData:{visible:!1,isEdit:!1,content:{},name:"",ruleValue:""},currentRow:null}},beforeDestroy(){document.removeEventListener("visibilitychange",this.visibleChange)},computed:{lockAutoUpdate(){return!!this.editData.visible}},methods:{visibleChange(){this.pageShow()},closeDetail(){this.currentRow=null},getInit(){B().then((t=>{const{rules:e}=t;this.getRules(e)}))},getRules(t){const{defaultRules:e,defaultRulesIsDisabled:a,list:n}=t;let i=[];i=a?[]:(0,G._)(e);let s=[];const o=n.filter((t=>t.selected));o.length&&o.forEach((t=>{const e=(0,G._)(t.data);s.push(...e)})),i.push(...s),this.activeRules=i.map((t=>({name:t,value:t}))),this.activeRules.unshift({name:"全部",value:""})},pageShow(){"visible"===document.visibilityState&&(this.searchApi(),this.getInit())},handleSelectRow(t){this.currentRow=t},autoUpdateList(){setInterval((()=>{U().then((t=>{const{code:e,data:a}=t;200===e&&a&&(this.lockAutoUpdate||this.searchApi())}))}),2e3)},handleEdit(t){try{this.editData.content="string"===typeof t.data?JSON.parse(t.data):t.data,this.editRow=t,this.editData.name=t.name,this.editData.ruleValue=t.ruleValue,this.editData.isEdit=!0,this.editData.visible=!0}catch(e){_().error(e.message)}},hideApiWindow(){this.editData.visible=!1},handleConfirm({content:t,name:e,ruleValue:a}){this.editData.content=t,this.editData.name=e,this.editData.ruleValue=a,this.editData.isEdit?this.updateApiData({name:e,content:t}):this.createApi({name:e,content:t,ruleValue:a})},handleCreate(){this.editData.isEdit=!1,this.editData.content={},this.editData.name="",this.editData.visible=!0},createApi(t){P(t).then((t=>{const{code:e,msg:a}=t;200!==e?_().error(a||"新建失败"):(_().success("新建成功"),this.hideApiWindow(),this.searchApi())})).catch((t=>{_().error(t.message||"更新失败")}))},updateApiData({name:t,content:e}){H(t,e).then((t=>{const{code:e,data:a}=t;if(200!==e)_().error("更新失败");else{const t=JSON.parse(a.data);this.editRow.time=t.time,this.editRow.data=t.data,this.editRow.updateTime=F()(t.time).format("YYYY-MM-DD HH:mm:ss"),_().success("更新成功"),this.hideApiWindow()}})).catch((()=>{_().error("更新失败")}))},updateMock(t,e){I(e.name,t).then((t=>{200!==t.code?_().error("更新失败"):_().success("更新成功")})).catch((()=>{_().error("更新失败")}))},deleteApi(t,e){q(t.name).then((t=>{200!==t.code?_().error("删除失败"):(_().success("删除成功"),this.list.splice(e,1))})).catch((()=>{_().error("删除失败")}))},batchDelete(){W(this.search).then((t=>{200!==t.code?_().error("删除失败"):(_().success("删除成功"),this.searchApi())})).catch((()=>{_().error("删除失败")}))},searchApi(){J(this.search).then((t=>{const{code:e,data:a}=t||{};if(200===e){const t=(a||[]).map((t=>{try{return{...t,expandUrl:!1,expandName:!1,payload:t.payload&&JSON.parse(t.payload)||{},updateTime:F()(t.time).format("YYYY-MM-DD HH:mm:ss"),mockTime:t.mockTime?F()(t.mockTime).format("YYYY-MM-DD HH:mm:ss"):""}}catch(e){return t}}));this.list=t}else _().error("列表请求失败")})).catch((t=>{_().error(t)}))}}},pt=ht,mt=(0,st.Z)(pt,z,L,!1,null,"d879dfa2",null),ft=mt.exports,vt={name:"App",components:{List:ft}},bt=vt,yt=(0,st.Z)(bt,M,Y,!1,null,null,null),gt=yt.exports;N["default"].component($().name,$()),N["default"].component(T().name,T()),N["default"].component(A().name,A()),N["default"].component(R().name,R()),N["default"].component(x().name,x()),N["default"].component(j().name,j()),N["default"].component(_().name,_()),N["default"].component(w().name,w()),N["default"].component(y().name,y()),N["default"].component(v().name,v()),N["default"].component(m().name,m()),N["default"].component(h().name,h()),N["default"].component(d().name,d()),N["default"].component(r().name,r()),N["default"].component(o().name,o()),N["default"].component(i().name,i()),N["default"].config.productionTip=!1,new N["default"]({render:t=>t(gt)}).$mount("#app")},2371:function(t,e){e._=(t="")=>t.split("\n").map((t=>t.trim())).filter((t=>"#"!==t[0])).filter((t=>~t.indexOf("automock://"))).map((t=>t.trim())).map((t=>t.replace(/\s+/," ")))}},e={};function a(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,a),s.exports}a.m=t,function(){var t=[];a.O=function(e,n,i,s){if(!n){var o=1/0;for(d=0;d<t.length;d++){n=t[d][0],i=t[d][1],s=t[d][2];for(var l=!0,r=0;r<n.length;r++)(!1&s||o>=s)&&Object.keys(a.O).every((function(t){return a.O[t](n[r])}))?n.splice(r--,1):(l=!1,s<o&&(o=s));if(l){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[n,i,s]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,s,o=n[0],l=n[1],r=n[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(r)var d=r(a)}for(e&&e(n);c<o.length;c++)s=o[c],a.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return a.O(d)},n=self["webpackChunkweb"]=self["webpackChunkweb"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(7249)}));n=a.O(n)})();