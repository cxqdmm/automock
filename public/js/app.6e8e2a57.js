(function(){var t={9528:function(t,e,n){"use strict";var i=n(2245),a=n.n(i),o=n(6668),s=n.n(o),r=n(4412),c=n.n(r),l=n(7349),d=n.n(l),u=n(4863),h=n.n(u),p=n(8782),m=n.n(p),f=n(1192),v=n.n(f),b=n(4400),y=n.n(b),g=n(8807),k=n.n(g),w=n(2711),C=n.n(w),j=n(8935),D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("List")],1)},_=[],A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"list"},[n("div",{staticClass:"list-head"},[n("div",{staticClass:"list-head-search"},[n("div",{staticClass:"list-head-item"},[n("span",{staticClass:"list-head-item-label"},[t._v("规则")]),n("el-select",{staticClass:"list-head-item",attrs:{placeholder:"请选择关联的pattern"},on:{change:t.searchApi},model:{value:t.search.pattern,callback:function(e){t.$set(t.search,"pattern",e)},expression:"search.pattern"}},t._l(t.activePatterns,(function(t){return n("el-option",{key:t.name,attrs:{label:t.name,value:t.value}})})),1)],1),n("el-input",{staticClass:"list-head-item list-head-name",attrs:{clearable:"",placeholder:"接口名模糊匹配"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchApi.apply(null,arguments)}},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchApi},slot:"append"})],1)],1),n("div",{staticClass:"list-head-action"},[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handleCreate}},[t._v("新建")]),n("el-divider",{attrs:{direction:"vertical"}}),t.search.onlymock?n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.batchDelete}},[t._v("清空mock")]):n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.batchDelete}},[t._v("清空非mock项")]),n("el-divider",{attrs:{direction:"vertical"}}),n("el-switch",{attrs:{"active-text":"显示mock","inactive-text":"显示全部","active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.searchApi},model:{value:t.search.onlymock,callback:function(e){t.$set(t.search,"onlymock",e)},expression:"search.onlymock"}})],1)]),n("div",{staticClass:"list-body"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,height:"800",border:"",size:"mini","row-key":"name"}},[n("el-table-column",{attrs:{prop:"name",label:"接口名"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{class:{hightlight:e.row.mock}},[t._v(" "+t._s(e.row.name)+" ")])]}}])}),n("el-table-column",{attrs:{prop:"pattern",label:"规则",width:"400"}}),n("el-table-column",{attrs:{prop:"mockTime",label:"命中mock时间",width:"200"}}),n("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"200"}}),n("el-table-column",{attrs:{label:"mock",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{input:function(n){return t.updateMock(n,e.row)}},model:{value:e.row.mock,callback:function(n){t.$set(e.row,"mock",n)},expression:"scope.row.mock"}})]}}])}),n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini"},on:{click:function(n){return t.handleEdit(e.row)}}},[t._v(" 编辑 ")]),n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){return t.deleteApi(e.row,e.$index)}}},[t._v(" 删除 ")])]}}])})],1)],1),n("div",{staticClass:"list-footer"}),n("api-window",{attrs:{"is-edit":t.editData.isEdit,visible:t.editData.visible,data:t.editData},on:{close:t.hideApiWindow,confirm:t.handleConfirm}})],1)},S=[];function O(t){return fetch("/cgi-bin/api-list",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function x(){return fetch("/cgi-bin/check-api-list").then((t=>t.json()))}function E(){return fetch("/cgi-bin/init?_="+Date.now(),{method:"get",referrer:location.origin}).then((t=>t.json()))}function T(t,e){return fetch("/cgi-bin/update-api-data",{method:"post",body:JSON.stringify({name:t,data:e}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function $(t,e){return fetch("/cgi-bin/create-api-data",{method:"post",body:JSON.stringify({name:t,data:e}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function M(t,e){return fetch("/cgi-bin/update-api-mock",{method:"post",body:JSON.stringify({name:t,mock:e}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function Y(t){return fetch("/cgi-bin/delete-api",{method:"post",body:JSON.stringify({name:t}),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}function P(t){return fetch("/cgi-bin/batch-delete-api",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}var N=n(3189),z=n.n(N),J=n(2371),L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"dialog",attrs:{title:t.isEdit?"编辑":"新建",fullscreen:"",visible:t.visible,width:"1000px","before-close":t.close}},[n("div",{staticClass:"item"},[n("span",{staticClass:"item-label"},[t._v(" url: ")]),n("el-input",{attrs:{placeholder:"请输入url（ 注意：url = location.origin + location.pathname）",disabled:t.isEdit,clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),n("div",{staticClass:"editor"},[n("span",{staticClass:"item-label"},[t._v(" 内容: ")]),n("code-editor",{ref:"edit",attrs:{"show-btns":!1,"expanded-on-start":!0,mode:"code",lang:"zh"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.close}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)])},R=[],B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-editor"},[n("div",{staticClass:"jsoneditor-vue"}),!1!==t.showBtns?n("div",{staticClass:"jsoneditor-btns"},[n("button",{staticClass:"json-save-btn",attrs:{type:"button",disabled:t.error},on:{click:function(e){return t.onSave()}}},[t._v(" "+t._s(t.locale[t.lang].save)+" ")])]):t._e()])},H=[],I=n(5056),U=n.n(I),W={props:{value:[String,Number,Object,Array],showBtns:[Boolean],expandedOnStart:{type:Boolean,default:!1},mode:{type:String,default:"tree"},modes:{type:Array,default:function(){return["tree","code","text","view"]}},lang:{type:String,default:"en"}},data(){return{editor:null,error:!1,json:this.value,internalChange:!1,locale:{it:{save:"SALVA"},en:{save:"SAVE"},zh:{save:"保存"}}}},watch:{value:{immediate:!0,async handler(t){this.internalChange||(await this.setEditor(t),this.error=!1)},deep:!0}},mounted(){let t=this,e={mode:this.mode,modes:this.modes,onChange(){try{let e=t.editor.get();t.json=e,t.error=!1,t.$emit("json-change",e),t.internalChange=!0,t.$emit("input",e),t.$nextTick((function(){t.internalChange=!1}))}catch(e){t.error=!0,t.$emit("has-error",e)}},onModeChange(){}};this.editor=new(U())(this.$el.querySelector(".jsoneditor-vue"),e,this.json)},methods:{onSave(){this.$emit("json-save",this.json)},async setEditor(t){this.editor&&this.editor.set(t)}}},Z=W,V=n(1001),q=(0,V.Z)(Z,B,H,!1,null,"2d467e86",null),F=q.exports,G={props:{isEdit:{type:Boolean,default:!1},data:{type:Object,deafult:{}},visible:{type:Boolean,default:!1}},components:{"code-editor":F},data(){return{content:{},name:""}},watch:{visible(t){t&&(this.content=this.data.content,this.name=this.data.name)}},methods:{close(){this.$emit("close")},confirm(){this.$emit("confirm",{content:this.content,name:this.name})}}},K=G,Q=(0,V.Z)(K,L,R,!1,null,"6f1f9813",null),X=Q.exports,tt={name:"api-list",components:{"api-window":X},mounted(){this.searchApi(),this.autoUpdateList(),this.getInit(),document.addEventListener("visibilitychange",this.visibleChange)},data(){return{search:{name:"",pattern:"",onlymock:!1},list:[],activePatterns:[{name:"全部",value:""}],view:{},editRow:null,editData:{visible:!1,isEdit:!1,content:{},name:""}}},beforeDestroy(){document.removeEventListener("visibilitychange",this.visibleChange)},computed:{lockAutoUpdate(){return!!this.editData.visible}},methods:{visibleChange(){this.pageShow()},getInit(){E().then((t=>{const{rules:e}=t;this.getActivePatterns(e)}))},getActivePatterns(t){const{defaultRules:e,defaultRulesIsDisabled:n,list:i}=t;let a=[];a=n?[]:(0,J.g)(e);let o=[];const s=i.filter((t=>t.selected));s.length&&s.forEach((t=>{const e=(0,J.g)(t.data);o.push(...e)})),a.push(...o),this.activePatterns=a.map((t=>({name:t,value:t}))),this.activePatterns.unshift({name:"全部",value:""})},pageShow(){"visible"===document.visibilityState&&(this.searchApi(),this.getInit())},autoUpdateList(){setInterval((()=>{x().then((t=>{const{code:e,data:n}=t;200===e&&n&&(this.lockAutoUpdate||this.searchApi())}))}),2e3)},handleEdit(t){try{this.editData.content="string"===typeof t.data?JSON.parse(t.data):t.data,this.editRow=t,this.editData.isEdit=!0,this.editData.visible=!0,this.editData.name=t.name}catch(e){d().error(e.message)}},hideApiWindow(){this.editData.visible=!1},handleConfirm({content:t,name:e}){this.editData.content=t,this.editData.name=e,this.editData.isEdit?this.updateApiData({name:this.editData.name,content:t}):this.createApi({name:this.editData.name,content:t})},handleCreate(){this.editData.isEdit=!1,this.editData.content={},this.editData.name="",this.editData.visible=!0},createApi({name:t,content:e}){$(t,e).then((t=>{const{code:e,msg:n}=t;200!==e?d().error(n||"新建失败"):(d().success("新建成功"),this.hideApiWindow(),this.searchApi())})).catch((t=>{d().error(t.message||"更新失败")}))},updateApiData({name:t,content:e}){T(t,e).then((t=>{const{code:e,data:n}=t;if(200!==e)d().error("更新失败");else{const t=JSON.parse(n.data);this.editRow.time=t.time,this.editRow.data=t.data,this.editRow.updateTime=z()(t.time).format("YYYY-MM-DD HH:mm:ss"),d().success("更新成功"),this.hideApiWindow()}})).catch((()=>{d().error("更新失败")}))},updateMock(t,e){M(e.name,t).then((t=>{200!==t.code?d().error("更新失败"):d().success("更新成功")})).catch((()=>{d().error("更新失败")}))},deleteApi(t,e){Y(t.name).then((t=>{200!==t.code?d().error("删除失败"):(d().success("删除成功"),this.list.splice(e,1))})).catch((()=>{d().error("删除失败")}))},batchDelete(){P(this.search).then((t=>{200!==t.code?d().error("删除失败"):(d().success("删除成功"),this.searchApi())})).catch((()=>{d().error("删除失败")}))},searchApi(){O(this.search).then((t=>{const{code:e,data:n}=t||{};if(200===e){const t=(n||[]).map((t=>{try{return{...t,updateTime:z()(t.time).format("YYYY-MM-DD HH:mm:ss"),mockTime:t.mockTime?z()(t.mockTime).format("YYYY-MM-DD HH:mm:ss"):""}}catch(e){return t}}));this.list=t}else d().error("列表请求失败")})).catch((t=>{d().error(t)}))}}},et=tt,nt=(0,V.Z)(et,A,S,!1,null,"1b114d2e",null),it=nt.exports,at={name:"App",components:{List:it}},ot=at,st=(0,V.Z)(ot,D,_,!1,null,null,null),rt=st.exports;j["default"].component(C().name,C()),j["default"].component(k().name,k()),j["default"].component(y().name,y()),j["default"].component(v().name,v()),j["default"].component(m().name,m()),j["default"].component(h().name,h()),j["default"].component(d().name,d()),j["default"].component(c().name,c()),j["default"].component(s().name,s()),j["default"].component(a().name,a()),j["default"].config.productionTip=!1,new j["default"]({render:t=>t(rt)}).$mount("#app")},2371:function(t,e){e.g=(t="")=>t.split("\n").map((t=>t.trim())).filter((t=>"#"!==t[0])).filter((t=>~t.indexOf("automock://"))).map((t=>t.split(" ")[0]))}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,i,a,o){if(!i){var s=1/0;for(d=0;d<t.length;d++){i=t[d][0],a=t[d][1],o=t[d][2];for(var r=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((function(t){return n.O[t](i[c])}))?i.splice(c--,1):(r=!1,o<s&&(s=o));if(r){t.splice(d--,1);var l=a();void 0!==l&&(e=l)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,a,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,o,s=i[0],r=i[1],c=i[2],l=0;if(s.some((function(e){return 0!==t[e]}))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(c)var d=c(n)}for(e&&e(i);l<s.length;l++)o=s[l],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(d)},i=self["webpackChunkweb"]=self["webpackChunkweb"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(9528)}));i=n.O(i)})();